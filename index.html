<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Pintarkit Affiliate Selector - Cari ejen sah kami.">
    <title>Pintarkit Affiliate Selector</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* --- CORE VARIABLES --- */
        :root {
            --bg-main: #FFF6DE;
            --bg-sec: #F2E0AA;
            --primary: #F4A417;     
            --primary-dark: #d68b0e;
            --text-main: #1E1A1A;
            --footer-bg: #623017;
            --footer-text: #FFFFFF;
            --white: #FFFFFF;
            --radius: 12px;
            --shadow: 0 4px 6px rgba(0,0,0,0.08);
        }

        /* --- RESET & BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-main);
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            line-height: 1.5;
        }

        /* --- LAYOUT UTILS --- */
        .w-full { width: 100%; }
        .hidden { display: none !important; }
        .text-center { text-align: center; }
        .container {
            max-width: 450px;
            margin: 0 auto;
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        /* --- HEADER --- */
        header {
            padding: 1rem;
            position: relative;
            display: flex;
            justify-content: flex-end; 
            align-items: center;
        }
        .logo-container {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            top: 1rem;
        }
        .logo-img { height: 70px; width: auto; }
        .lang-btn {
            background: var(--white);
            border: 1px solid var(--primary);
            padding: 4px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: all 0.2s;
        }
        .lang-btn:hover { background: var(--bg-sec); }

        /* --- CARDS & BUTTONS --- */
        .card {
            background: var(--white);
            border: 2px solid var(--bg-sec);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1rem;
            transition: transform 0.2s;
        }
        .card-btn {
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            text-align: center;
        }
        .card-btn:hover { background-color: #ffxfeb; transform: translateY(-2px); }
        .icon-circle {
            background: #FFEDD5;
            padding: 10px;
            border-radius: 50%;
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--text-main);
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            width: 100%;
            font-size: 1rem;
            transition: background 0.2s, transform 0.1s;
            box-shadow: 0 4px 0 rgba(0,0,0,0.1); 
        }
        .btn-primary:hover { background-color: var(--primary-dark); }
        .btn-primary:active { transform: translateY(2px); box-shadow: none; }
        .btn-primary:disabled { opacity: 0.6; cursor: not-allowed; }

        /* --- INPUTS --- */
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--bg-sec);
            border-radius: 8px;
            font-size: 1.1rem;
            text-align: center;
            text-transform: uppercase;
            outline: none;
            margin-bottom: 1rem;
        }
        input[type="text"]:focus { border-color: var(--primary); }
        .error-msg { color: #dc2626; font-size: 0.8rem; margin-bottom: 10px; }

        /* --- DIGITAL SHUFFLE BOX --- */
        .digital-box {
            background: #2D2D2D;
            border: 6px solid var(--primary);
            border-radius: 12px;
            width: 100%;
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem auto;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.5);
        }
        .scanline {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%);
            background-size: 100% 4px;
            pointer-events: none; z-index: 2;
        }
        .shuffle-text {
            font-family: 'Share Tech Mono', monospace;
            font-size: 2.8rem;
            color: #4ADE80;
            text-shadow: 0 0 10px rgba(74, 222, 128, 0.7);
            z-index: 1;
        }
        .thinking .shuffle-text { animation: pulse 0.15s infinite; }
        @keyframes pulse { 0% { opacity: 0.7; } 100% { opacity: 1; } }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.6);
            z-index: 50; display: flex; align-items: center; justify-content: center;
            padding: 1rem;
        }
        .modal-card {
            background: white; border-radius: var(--radius);
            padding: 2rem; width: 100%; max-width: 380px;
            text-align: center; position: relative;
            animation: bounceIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .close-modal {
            position: absolute; top: 10px; right: 15px;
            background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #999;
        }
        .success-icon {
            width: 60px; height: 60px; background: #dcfce7; color: #16a34a;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 2rem; margin: 0 auto 1rem auto;
        }
        @keyframes bounceIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* --- FOOTER --- */
        footer {
            background-color: var(--footer-bg);
            color: var(--footer-text);
            text-align: center;
            padding: 1rem;
            margin-top: auto;
            font-size: 0.75rem;
        }
        .nav-back {
            background: none; border: none; font-weight: bold;
            color: var(--footer-bg); cursor: pointer; display: flex; align-items: center; gap: 5px; margin-bottom: 1rem;
        }

        /* --- LOADER --- */
        .loader-overlay {
            position: fixed; inset: 0; background: rgba(255,255,255,0.9);
            z-index: 60; display: flex; align-items: center; justify-content: center;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid var(--bg-sec);
            border-top-color: var(--primary); border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <header>
        <div class="logo-container">
            <img src="https://i.postimg.cc/Nj2LV4kY/38186f61-54d4-4d05-a75e-29375e019f3f-removebg-preview.png" alt="Pintarkit" class="logo-img">
        </div>
        <div class="lang-btn" onclick="toggleLanguage()">
            <span id="lang-display">BM üá≤üáæ</span>
        </div>
    </header>

    <main class="container">
        
        <!-- HOME VIEW -->
       <div id="view-home">
    <h2 class="text-center" style="margin-bottom: 0.5rem; font-weight: 700;">Sokong Usahawan Pintarkit</h2>
    
    <div style="background: #fff; padding: 15px; border-radius: 8px; font-size: 0.85rem; margin-bottom: 1.5rem; border: 1px solid #F2E0AA; box-shadow: 0 4px 6px rgba(0,0,0,0.02); text-align: center; color: #555; line-height: 1.6;">
        <p>
            Setiap pembelian anda menyumbang rezeki kepada <strong>Ahli Pintarkit Members</strong> yang berdaftar.
        </p>
        <p style="margin-top: 8px;">
            Mereka adalah <span style="color: #d97706; font-weight: 600;">ketua keluarga, suri rumah, pendidik dan mahasiswa</span> yang sedang gigih berniaga demi menyara kehidupan.
        </p>
    </div>


            <button onclick="switchView('search')" class="card card-btn">
                <div class="icon-circle">üîç</div>
                <h3 style="font-weight: 700;" data-key="opt_search_title">Cari ID Ejen</h3>
                <p style="font-size: 0.8rem; color: #666;" data-key="opt_search_desc">Masukkan ID ahli yang anda kenali.</p>
            </button>
            
            <button onclick="switchView('random')" class="card card-btn">
                <div class="icon-circle">üé≤</div>
                <h3 style="font-weight: 700;" data-key="opt_random_title">Pilih Secara Rawak</h3>
                <p style="font-size: 0.8rem; color: #666;" data-key="opt_random_desc">Kami pilihkan ahli bertuah untuk anda.</p>
            </button>

            <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px dashed #ccc; text-align: center;">
                <p style="font-size: 0.8rem; font-weight: 700; color: #623017; margin-bottom: 5px;" data-key="member_cta_title">
                    Nak nama anda tersenarai dalam sistem "Auto-Sales" ini?
                </p>
                <p style="font-size: 0.75rem; color: #666; margin-bottom: 10px;" data-key="member_cta_desc">
                    Khas untuk pemegang <strong>Pintarkit Members</strong> sahaja.
                </p>
                
                <a href="https://wa.me/60182787752?text=Hai%20PintarKit!%20Saya%20nak%20daftar%20sebagai%20affiliate%20Pintarkit." target="_blank" style="
                    display: inline-block;
                    background-color: #222; 
                    color: #fff; 
                    padding: 8px 16px; 
                    border-radius: 20px; 
                    font-size: 0.75rem; 
                    text-decoration: none; 
                    font-weight: bold;">
                    <span data-key="member_cta_btn">Daftar Pintarkit Members Sekarang &rarr;</span>
                </a>
            </div>
        </div>

        <!-- SEARCH VIEW -->
        <div id="view-search" class="hidden">
            <button onclick="switchView('home')" class="nav-back">‚Üê <span data-key="back">Kembali</span></button>
            <div class="card text-center">
                <h3 style="margin-bottom: 1rem;" data-key="opt_search_title">Cari ID Ejen</h3>
                <input type="text" id="agent-input" placeholder="Contoh: CIKGU_NIM">
                <p id="search-error" class="error-msg hidden" data-key="error_not_found">ID tidak dijumpai.</p>
                <button onclick="handleSearch()" class="btn-primary" data-key="btn_search">Cari & Beli</button>
            </div>
        </div>

        <!-- RANDOM VIEW -->
        <div id="view-random" class="hidden text-center">
            <button onclick="switchView('home')" class="nav-back">‚Üê <span data-key="back">Kembali</span></button>
            <h3 style="margin-bottom: 1rem; font-weight: 700;" data-key="spin_title">Ejen Bertuah Digital</h3>
            
            <div class="digital-box" id="digital-box">
                <div class="scanline"></div>
                <div class="shuffle-text" id="shuffle-text">???</div>
            </div>
            
            <p style="font-size: 0.8rem; color: #666; margin-bottom: 1rem;" data-key="click_to_start">Klik butang di bawah untuk mula</p>
            
            <button id="spin-btn" onclick="startDigitalShuffle()" class="btn-primary" style="border-radius: 50px; padding: 15px 40px; font-size: 1.2rem;">
                <span data-key="btn_spin">MULA CABUTAN!</span>
            </button>
        </div>

    </main>

    <!-- RESULT MODAL -->
    <div id="result-overlay" class="modal-overlay hidden">
        <div class="modal-card">
            <button onclick="closeResult()" class="close-modal">&times;</button>
            <div class="success-icon">‚úì</div>
            <h3 style="margin-bottom: 5px;" data-key="agent_found">Ejen Dijumpai!</h3>
            <p style="font-size: 0.9rem; color: #666; margin-bottom: 1.5rem;" data-key="please_support">Sila sokong ejen ini.</p>
            
            <div style="background: var(--bg-main); padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                <p style="font-size: 0.75rem; color: #666;" data-key="agent_id_label">ID Ejen</p>
                <h2 id="result-id" style="font-size: 2rem; font-weight: 900; color: var(--footer-bg); word-break: break-all;">PK-XXX</h2>
            </div>
            
            <a id="result-link" href="#" target="_blank" class="btn-primary" style="display: block; text-decoration: none;" data-key="btn_buy">Teruskan ke Pembayaran</a>
        </div>
    </div>

    <!-- GLOBAL LOADER -->
    <div id="global-loader" class="loader-overlay hidden">
        <div class="spinner"></div>
    </div>

    <script>
    // --- KONFIGURASI ---
    const CONFIG = {
        SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzHfPkRdPm2d1k2syGek6ApxtQ6KwmUUPGv53aWEroNvGdYRBWZ13Rpk2Fvp2NaSZRx/exec',
        CACHE_KEY: 'pintarkit_data_v2', // v2 untuk reset cache lama
        CACHE_TIME: 1000 * 60 * 30 // 30 Minit (Kurangkan beban server)
    };

    // --- BAHASA (DIKEMASKINI) ---
    const TR = {
        bm: {
            // General
            lang_display: "BM üá≤üáæ",
            back: "Kembali",
            // Home
            home_title: "Sokong Affiliate Pintarkit",
            home_desc_1: "Setiap pembelian anda akan menyumbang komisen kepada Ahli Pintarkit Members yang berdaftar sebagai affiliate Pintarkit.",
            home_desc_2: "(Mereka adalah ketua keluarga, suri rumah, pendidik dan mahasiswa yang sedang gigih berniaga demi menyara kehidupan.)",
            // Options
            opt_search_title: "Cari ID Ejen",
            opt_search_desc: "Masukkan ID ahli yang anda kenali.",
            opt_random_title: "Pilih Secara Rawak",
            opt_random_desc: "Kami pilihkan ahli bertuah untuk anda.",
            // Membership CTA
            member_cta_title: "Nak nama anda tersenarai dalam sistem \"Auto-Sales\" ini?",
            member_cta_desc: "Khas untuk pemegang Pintarkit Members sahaja.",
            member_cta_btn: "Daftar Pintarkit Members Sekarang ‚Üí",
            // Search View
            btn_search: "Cari & Beli",
            error_not_found: "ID tidak dijumpai.",
            // Random View
            spin_title: "Ejen Bertuah Digital",
            click_to_start: "Klik butang di bawah untuk mula",
            btn_spin: "MULA CABUTAN!",
            // Result Modal
            agent_found: "Ejen Dijumpai!",
            please_support: "Sila sokong ejen ini.",
            agent_id_label: "ID Ejen",
            btn_buy: "Teruskan ke Pembayaran"
        },
        en: {
            // General
            lang_display: "EN üá¨üáß",
            back: "Back",
            // Home
            home_title: "Support Pintarkit Entrepreneurs",
            home_desc_1: "Every purchase you make contributes commission to registered Pintarkit Members.",
            home_desc_2: "(They are breadwinners, housewives, educators, and students working hard to earn a living.)",
            // Options
            opt_search_title: "Search Agent ID",
            opt_search_desc: "Enter the member ID you know.",
            opt_random_title: "Pick Randomly",
            opt_random_desc: "We will pick a lucky member for you.",
            // Membership CTA
            member_cta_title: "Want your name listed in this \"Auto-Sales\" system?",
            member_cta_desc: "Exclusively for Pintarkit Members holders.",
            member_cta_btn: "Join Pintarkit Members Now ‚Üí",
            // Search View
            btn_search: "Search & Buy",
            error_not_found: "ID not found.",
            // Random View
            spin_title: "Digital Lucky Agent",
            click_to_start: "Click button below to start",
            btn_spin: "START DRAW!",
            // Result Modal
            agent_found: "Agent Found!",
            please_support: "Please support this agent.",
            agent_id_label: "Agent ID",
            btn_buy: "Proceed to Payment"
        }
    };

    // --- STATE ---
    let state = {
        lang: 'bm',
        agents: [], 
        loading: false
    };

    // --- SYSTEM LOGIC ---
    const App = {
        init: () => {
            App.renderText(); // Render bahasa awal (BM)
            App.loadData();
        },

        // 1. DATA FETCHING
        loadData: async () => {
            const loader = document.getElementById('global-loader');
            loader.classList.remove('hidden');

            const cached = localStorage.getItem(CONFIG.CACHE_KEY);
            if (cached) {
                const data = JSON.parse(cached);
                const age = Date.now() - data.ts;
                if (age < CONFIG.CACHE_TIME) {
                    state.agents = data.payload;
                    loader.classList.add('hidden');
                    return;
                }
            }

            try {
                const res = await fetch(CONFIG.SCRIPT_URL);
                if(!res.ok) throw new Error("Server Busy");
                const agents = await res.json();
                
                state.agents = agents;
                localStorage.setItem(CONFIG.CACHE_KEY, JSON.stringify({
                    ts: Date.now(),
                    payload: agents
                }));
            } catch (e) {
                console.error("Gagal fetch", e);
                if(cached) {
                    state.agents = JSON.parse(cached).payload;
                } else {
                    alert("Maaf, sistem sibuk. Sila cuba sebentar lagi.");
                }
            } finally {
                loader.classList.add('hidden');
            }
        },

        // 2. UI HELPERS & LANGUAGE
        switchView: (view) => {
            ['view-home', 'view-search', 'view-random'].forEach(id => 
                document.getElementById(id).classList.add('hidden')
            );
            document.getElementById(`view-${view}`).classList.remove('hidden');
            
            if(view === 'search') {
                document.getElementById('agent-input').value = '';
                document.getElementById('search-error').classList.add('hidden');
            }
            if(view === 'random') {
                 document.getElementById('shuffle-text').innerText = "???";
            }
        },

        toggleLang: () => {
            state.lang = state.lang === 'bm' ? 'en' : 'bm';
            App.renderText();
        },

        renderText: () => {
            const t = TR[state.lang];
            
            // Cari semua elemen yang ada attribute 'data-key'
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (t[key]) {
                    // Jika teks ada HTML tag (bold), guna innerHTML, jika tak innerText
                    if(t[key].includes('<')) {
                        el.innerHTML = t[key];
                    } else {
                        el.innerText = t[key];
                    }
                }
            });

            // Tukar label butang bahasa
            document.getElementById('lang-display').innerText = t.lang_display;

            // Tukar placeholder input secara manual sebab placeholder ialah attribute
            const inputPlaceholders = {
                bm: "Contoh: CIKGU_NIM",
                en: "Example: CIKGU_NIM"
            };
            document.getElementById('agent-input').placeholder = inputPlaceholders[state.lang];
        },

        // 3. FEATURE: SEARCH
        search: () => {
            const input = document.getElementById('agent-input').value.trim().toUpperCase();
            const found = state.agents.find(a => a.id === input);
            
            if(found) {
                document.getElementById('search-error').classList.add('hidden');
                App.showResult(found);
            } else {
                document.getElementById('search-error').classList.remove('hidden');
            }
        },

        // 4. FEATURE: SHUFFLE
        shuffle: () => {
            if(state.agents.length === 0) return;
            
            const btn = document.getElementById('spin-btn');
            const box = document.getElementById('digital-box');
            const txt = document.getElementById('shuffle-text');
            
            btn.disabled = true;
            box.classList.add('thinking');
            
            let count = 0;
            const max = 20; 
            
            const interval = setInterval(() => {
                const r = Math.floor(Math.random() * state.agents.length);
                txt.innerText = state.agents[r].id;
                count++;
                
                if(count >= max) {
                    clearInterval(interval);
                    box.classList.remove('thinking');
                    
                    const winner = state.agents[Math.floor(Math.random() * state.agents.length)];
                    txt.innerText = winner.id;
                    
                    confetti({ particleCount: 50, spread: 70, origin: { y: 0.6 } });
                    
                    setTimeout(() => {
                        App.showResult(winner);
                        btn.disabled = false;
                    }, 800);
                }
            }, 80);
        },

        showResult: (agent) => {
            document.getElementById('result-id').innerText = agent.id;
            document.getElementById('result-link').href = agent.link;
            document.getElementById('result-overlay').classList.remove('hidden');
        },
        
        closeResult: () => {
            document.getElementById('result-overlay').classList.add('hidden');
        }
    };

    // Expose global functions
    window.switchView = App.switchView;
    window.toggleLanguage = App.toggleLang;
    window.handleSearch = App.search;
    window.startDigitalShuffle = App.shuffle;
    window.closeResult = App.closeResult;

    // Start
    window.onload = App.init;
    </script>
</body>
</html>